// Import the necessary Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

// Import the functions you need from the SDKs you need
// import { initializeApp } from "firebase/app";
// import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDZ-Dtx4ak9AyP73_nfejGVHkSheVwu6lk",
  authDomain: "cs-7633-study.firebaseapp.com",
  projectId: "cs-7633-study",
  storageBucket: "cs-7633-study.firebasestorage.app",
  messagingSenderId: "544838145446",
  appId: "1:544838145446:web:8d5a31b26f4ac31d89ab67",
  measurementId: "G-3MR36PDV04"
};

// Initialize Firebase

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);

// // Initialize global variable for userId
let userId = null;

// Sign in the user anonymously
signInAnonymously(auth)
    .then(() => {
        console.log("User signed in anonymously");
    })
    .catch((error) => {
        console.error("Error signing in anonymously:", error);
    });

// Set up listener for user authentication state changes
onAuthStateChanged(auth, (user) => {
    if (user) {
        // User is signed in
        userId = user.uid; // Unique user ID
        console.log("Authenticated user ID:", userId);
    } else {
        console.error("User not signed in.");
    }
});

// Function to store button click data with user ID
window.storeButtonClickData = function(buttonName) {
    // if (!userId) {
    //     console.error("No user ID available. Unable to store data.");
    //     return;
    // }

    console.log("Storing button click:", buttonName); // Debugging log
    const buttonClicksRef = ref(database, 'buttonClicks');
    
    // Push data to Firebase Realtime Database
    push(buttonClicksRef, {
        userId: "user", // Store user ID
        buttonName: buttonName,
        timestamp: Date.now()
    })
    .then(() => {
        console.log("Button click data saved AUCCCESSFULLY:", buttonName);
    })
    .catch((error) => {
        console.error("Error saving button click data:", error);
    });
};

// Function to store email data
window.storeEmailData = function(email) {
   
    console.log("Storing email:", email);
    const emailRef = ref(database, 'userEmails');
    
    push(emailRef, {
        userId: userId,  // Associate the email with the user ID
        email: email,
        timestamp: Date.now()
    })
    .then(() => {
        console.log("Email stored successfully:", email);
    })
    .catch((error) => {
        console.error("Error storing email:", error);
    });
};

